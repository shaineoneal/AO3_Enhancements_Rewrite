(()=>{"use strict";var e,t={680:(e,t,n)=>{var r=n(557),o=n(526),a=n(961);const s=(...e)=>{console.log(...e)},i=e=>(0,r.jsx)("div",{className:"loggedIn",children:(0,r.jsx)("button",{id:"sheet-button",onClick:function(){s("going to url: ",e.spreadsheetUrl),chrome.tabs.create({url:e.spreadsheetUrl})},children:"View your sheet"})});var u=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function i(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))};function d(){return u(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{chrome.cookies.get({name:"authToken",url:"https://archiveofourown.org"},(n=>{n?(s("cookie.value: ",n.value),e(n.value)):t("Error getting token")}))}))}))}var l=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function i(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))};function c(){return s("getting spreadsheet URL"),new Promise(((e,t)=>{chrome.storage.sync.get(["spreadsheetUrl"],(n=>l(this,void 0,void 0,(function*(){s("fetchSpreadSheetUrl result: ",n);const r=n.spreadsheetUrl;if(s("spreadsheetUrl type: ",typeof r),void 0!==r&&0!==Object.keys(r).length)s("user has spreadsheet URL: ",r),s("spreadsheetID: ",String(r).split("/")[5]),e(r);else{s("user doesn't have spreadsheet URL, creating spreadsheet");const n=yield d();null===n?t("Error getting token"):yield function(e){return l(this,void 0,void 0,(function*(){const t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({properties:{title:"AO3E"},namedRanges:[{namedRangeId:"0",name:"WorkID",range:{sheetId:0,startColumnIndex:0,endColumnIndex:1}},{namedRangeId:"1",name:"title",range:{sheetId:0,startColumnIndex:1,endColumnIndex:2}},{namedRangeId:"2",name:"authors",range:{sheetId:0,startColumnIndex:2,endColumnIndex:3}},{namedRangeId:"3",name:"fandoms",range:{sheetId:0,startColumnIndex:3,endColumnIndex:4}},{namedRangeId:"4",name:"relationships",range:{sheetId:0,startColumnIndex:4,endColumnIndex:5}},{namedRangeId:"5",name:"tags",range:{sheetId:0,startColumnIndex:5,endColumnIndex:6}},{namedRangeId:"6",name:"description",range:{sheetId:0,startColumnIndex:6,endColumnIndex:7}},{namedRangeId:"7",name:"wordCount",range:{sheetId:0,startColumnIndex:7,endColumnIndex:8}},{namedRangeId:"8",name:"chapterCount",range:{sheetId:0,startColumnIndex:8,endColumnIndex:9}},{namedRangeId:"9",name:"status",range:{sheetId:0,startColumnIndex:9,endColumnIndex:10}},{namedRangeId:"10",name:"rating",range:{sheetId:0,startColumnIndex:10,endColumnIndex:11}}],sheets:{properties:{title:"Saved Works",sheetId:0,gridProperties:{rowCount:1,columnCount:11,columnGroupControlAfter:!0}},protectedRanges:[{protectedRangeId:0,range:{},description:"Protected",warningOnly:!0}],data:[{startRow:0,startColumn:0,rowData:[{values:[{userEnteredValue:{stringValue:"Work ID"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Title"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Authors"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Fandoms"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Relationships"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Tags"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Description"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Word Count"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Chapter Count"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Status"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Rating"},userEnteredFormat:{textFormat:{bold:!0}}}]}]},{startColumn:0,columnMetadata:{pixelSize:100}},{startColumn:1,columnMetadata:{pixelSize:300}},{startColumn:2,columnMetadata:{pixelSize:200}},{startColumn:3,columnMetadata:{pixelSize:200}},{startColumn:4,columnMetadata:{pixelSize:100}},{startColumn:5,columnMetadata:{pixelSize:100}},{startColumn:6,columnMetadata:{pixelSize:100}}]}})};return s("options: ",t),fetch("https://sheets.googleapis.com/v4/spreadsheets",t).then((e=>(s("Response status:",e.status),e.json()))).then((e=>(s("Success:",e),chrome.storage.sync.set({spreadsheetUrl:e.spreadsheetUrl}),e.spreadsheetUrl))).catch((e=>{throw s("Error creating spreadsheet:",e),e}))}))}(n).then((t=>{e(t)})).catch((e=>{t(e)}))}}))))}))}const h=(0,o.createContext)({loader:!1,setLoader:()=>{}});function m({children:e}){const[t,n]=(0,o.useState)(!0);return(0,r.jsx)(h.Provider,{value:{loader:t,setLoader:n},children:e})}const g=(0,o.createContext)({authToken:"",setAuthToken:e=>{}});function x({children:e}){const[t,n]=(0,o.useState)("");return(0,r.jsx)(g.Provider,{value:{authToken:t,setAuthToken:n},children:e})}const p=chrome.identity.getRedirectURL(),{oauth2:f}=chrome.runtime.getManifest();if(!f)throw new Error("You need to specify oauth2 in manifest.json");const v=f.client_id,C=`https://accounts.google.com/o/oauth2/auth?${new URLSearchParams({client_id:v,response_type:"token",redirect_uri:p,scope:["https://www.googleapis.com/auth/spreadsheets"].join(" ")}).toString()}`;function I(e){return new Promise(((t,n)=>{chrome.identity.launchWebAuthFlow({url:C,interactive:e},(e=>{return r=this,o=void 0,i=function*(){s("responseUrl",e);const r=new URL(e);s("url",r);const o=new URLSearchParams(r.hash.slice(1));s("urlParams",o);const a=Object.fromEntries(o.entries());a.expires_in="43199",s("params",a);const i=a.access_token,u=yield function(e){return new Promise(((t,n)=>{chrome.cookies.set(e,(e=>{e&&s("createCookie cookie",e),t(e)}))}))}({name:"authToken",url:"https://www.archiveofourown.org/",value:i,expirationDate:Date.now()/1e3+43199,domain:".archiveofourown.org"});if(s("cookie",u),u)return t(u);n()},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{u(i.next(e))}catch(e){t(e)}}function s(e){try{u(i.throw(e))}catch(e){t(e)}}function u(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,s)}u((i=i.apply(r,o||[])).next())}));var r,o,a,i}))}))}const w=()=>{const{loader:e,setLoader:t}=(0,o.useContext)(h),{setAuthToken:n}=(0,o.useContext)(g);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h1",{children:"Please log in to begin"}),(0,r.jsx)("div",{className:"login",children:(0,r.jsx)("button",{id:"login-button",onClick:()=>{return e=void 0,r=void 0,a=function*(){t(!0),I(!0).then((e=>{n(e.value)}));const e=yield c();if(null===e)throw new Error("Error getting spreadsheet url");chrome.storage.sync.set({spreadsheetUrl:e}),t(!1)},new((o=void 0)||(o=Promise))((function(t,n){function s(e){try{u(a.next(e))}catch(e){n(e)}}function i(e){try{u(a.throw(e))}catch(e){n(e)}}function u(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,i)}u((a=a.apply(e,r||[])).next())}));var e,r,o,a},disabled:e,children:"Login to Google"})})]})};var y=n(222),j=n(866);const E=()=>{const{authToken:e}=(0,o.useContext)(g);return(0,o.useEffect)((()=>{console.log("useEffect")}),[e]),(0,r.jsx)(y.Pd.Provider,{value:{className:"settings-icon"},children:(0,r.jsx)("a",{href:"options.html",children:e?(0,r.jsx)(j.b4S,{}):null})})};const b=()=>{const{loader:e,setLoader:t}=(0,o.useContext)(h),[n,a]=(0,o.useState)(""),{authToken:u,setAuthToken:l}=(0,o.useContext)(g);return(0,o.useEffect)((()=>{s("useEffect"),function(){return e=this,t=void 0,r=function*(){s("authToken: ",u),d().then((e=>{""===e?s("user is not logged in"):(l(e),s("user is logged in"))})),c().then((e=>{s("url: ",e),a(e)}))},new((n=void 0)||(n=Promise))((function(o,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function i(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}));var e,t,n,r}().then((()=>{t(!1)}))}),[u]),e?(s("loader is true"),(0,r.jsx)("div",{className:"loader"})):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{children:u?(0,r.jsx)(i,{spreadsheetUrl:n}):(0,r.jsx)(w,{})})})};a.render((0,r.jsx)(o.StrictMode,{children:(0,r.jsx)((()=>{const{authToken:e}=(0,o.useContext)(g);return(0,o.useEffect)((()=>{}),[e]),(0,r.jsxs)(x,{children:[(0,r.jsx)("header",{children:(0,r.jsxs)("div",{className:"flex-container",children:[(0,r.jsx)("div",{className:"logo",children:(0,r.jsx)("img",{src:"icons/icon-32.png",alt:"extension-icon"})}),(0,r.jsx)("div",{className:"title",children:"AO3E: Rewritten"}),(0,r.jsx)(E,{})]})}),(0,r.jsx)("main",{children:(0,r.jsx)(m,{children:(0,r.jsx)("div",{className:"body",children:(0,r.jsx)(b,{})})})})]})}),{})}),document.getElementById("root"))}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.m=t,e=[],r.O=(t,n,o,a)=>{if(!n){var s=1/0;for(l=0;l<e.length;l++){for(var[n,o,a]=e[l],i=!0,u=0;u<n.length;u++)(!1&a||s>=a)&&Object.keys(r.O).every((e=>r.O[e](n[u])))?n.splice(u--,1):(i=!1,a<s&&(s=a));if(i){e.splice(l--,1);var d=o();void 0!==d&&(t=d)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[n,o,a]},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={42:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[s,i,u]=n,d=0;if(s.some((t=>0!==e[t]))){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(u)var l=u(r)}for(t&&t(n);d<s.length;d++)a=s[d],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(l)},n=self.webpackChunkchrome_extension_typescript_starter=self.webpackChunkchrome_extension_typescript_starter||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=r.O(void 0,[736],(()=>r(680)));o=r.O(o)})();