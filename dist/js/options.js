(()=>{"use strict";var e,t={938:(e,t,n)=>{var r=n(557),o=n(526),a=n(961),s=n(222),d=n(860);const i=(...e)=>{console.log(...e)};var u=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{i(r.next(e))}catch(e){a(e)}}function d(e){try{i(r.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,d)}i((r=r.apply(e,t||[])).next())}))};function l(){return u(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{chrome.cookies.get({name:"authToken",url:"https://archiveofourown.org"},(n=>{n?(i("cookie.value: ",n.value),e(n.value)):t("Error getting token")}))}))}))}var c=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{i(r.next(e))}catch(e){a(e)}}function d(e){try{i(r.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,d)}i((r=r.apply(e,t||[])).next())}))};function m(e){return c(this,void 0,void 0,(function*(){const t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({properties:{title:"AO3E"},namedRanges:[{namedRangeId:"0",name:"WorkID",range:{sheetId:0,startColumnIndex:0,endColumnIndex:1}},{namedRangeId:"1",name:"title",range:{sheetId:0,startColumnIndex:1,endColumnIndex:2}},{namedRangeId:"2",name:"authors",range:{sheetId:0,startColumnIndex:2,endColumnIndex:3}},{namedRangeId:"3",name:"fandoms",range:{sheetId:0,startColumnIndex:3,endColumnIndex:4}},{namedRangeId:"4",name:"relationships",range:{sheetId:0,startColumnIndex:4,endColumnIndex:5}},{namedRangeId:"5",name:"tags",range:{sheetId:0,startColumnIndex:5,endColumnIndex:6}},{namedRangeId:"6",name:"description",range:{sheetId:0,startColumnIndex:6,endColumnIndex:7}},{namedRangeId:"7",name:"wordCount",range:{sheetId:0,startColumnIndex:7,endColumnIndex:8}},{namedRangeId:"8",name:"chapterCount",range:{sheetId:0,startColumnIndex:8,endColumnIndex:9}},{namedRangeId:"9",name:"status",range:{sheetId:0,startColumnIndex:9,endColumnIndex:10}},{namedRangeId:"10",name:"rating",range:{sheetId:0,startColumnIndex:10,endColumnIndex:11}}],sheets:{properties:{title:"Saved Works",sheetId:0,gridProperties:{rowCount:1,columnCount:11,columnGroupControlAfter:!0}},protectedRanges:[{protectedRangeId:0,range:{},description:"Protected",warningOnly:!0}],data:[{startRow:0,startColumn:0,rowData:[{values:[{userEnteredValue:{stringValue:"Work ID"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Title"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Authors"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Fandoms"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Relationships"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Tags"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Description"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Word Count"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Chapter Count"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Status"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Rating"},userEnteredFormat:{textFormat:{bold:!0}}}]}]},{startColumn:0,columnMetadata:{pixelSize:100}},{startColumn:1,columnMetadata:{pixelSize:300}},{startColumn:2,columnMetadata:{pixelSize:200}},{startColumn:3,columnMetadata:{pixelSize:200}},{startColumn:4,columnMetadata:{pixelSize:100}},{startColumn:5,columnMetadata:{pixelSize:100}},{startColumn:6,columnMetadata:{pixelSize:100}}]}})};return i("options: ",t),fetch("https://sheets.googleapis.com/v4/spreadsheets",t).then((e=>(i("Response status:",e.status),e.json()))).then((e=>(i("Success:",e),chrome.storage.sync.set({spreadsheetUrl:e.spreadsheetUrl}),e.spreadsheetUrl))).catch((e=>{throw i("Error creating spreadsheet:",e),e}))}))}const h=(0,o.createContext)({loader:!1,setLoader:()=>{}});(0,o.createContext)({authToken:"",setAuthToken:e=>{}});const p=chrome.identity.getRedirectURL(),{oauth2:g}=chrome.runtime.getManifest();if(!g)throw new Error("You need to specify oauth2 in manifest.json");const x=g.client_id;new URLSearchParams({client_id:x,response_type:"token",redirect_uri:p,scope:["https://www.googleapis.com/auth/spreadsheets"].join(" ")});const v=()=>{const[e,t]=(0,o.useState)("");return(0,r.jsx)("div",{children:(0,r.jsx)("a",{className:"no-underline",href:"popup.html",children:(0,r.jsx)("button",{className:e,onClick:()=>{t("visited"),function(){u(this,void 0,void 0,(function*(){if(""===(yield l()))throw new Error("Error getting token");chrome.storage.sync.remove(["authToken"]),chrome.cookies.remove({name:"authToken",url:"https://archiveofourown.org"},(()=>{i("Removed cookie")}))}))}()},children:"Logout"})})})};const f=()=>{const{loader:e,setLoader:t}=(0,o.useContext)(h);return e?(0,r.jsx)("div",{className:"small loader"}):(0,r.jsx)("div",{children:(0,r.jsx)("button",{onClick:()=>{return e=void 0,n=void 0,o=function*(){t(!0),m(yield l()).then((e=>{chrome.storage.sync.set({spreadsheetUrl:e})}))},new((r=void 0)||(r=Promise))((function(t,a){function s(e){try{i(o.next(e))}catch(e){a(e)}}function d(e){try{i(o.throw(e))}catch(e){a(e)}}function i(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,d)}i((o=o.apply(e,n||[])).next())}));var e,n,r,o},children:"New Sheet"})})};a.render((0,r.jsx)(o.StrictMode,{children:(0,r.jsx)((()=>{const[e,t]=(0,o.useState)(""),[n,a]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{(function(){return i("getting spreadsheet URL"),new Promise(((e,t)=>{chrome.storage.sync.get(["spreadsheetUrl"],(n=>c(this,void 0,void 0,(function*(){i("fetchSpreadSheetUrl result: ",n);const r=n.spreadsheetUrl;if(i("spreadsheetUrl type: ",typeof r),void 0!==r&&0!==Object.keys(r).length)i("user has spreadsheet URL: ",r),i("spreadsheetID: ",String(r).split("/")[5]),e(r);else{i("user doesn't have spreadsheet URL, creating spreadsheet");const n=yield l();null===n?t("Error getting token"):yield m(n).then((t=>{e(t)})).catch((e=>{t(e)}))}}))))}))})().then((e=>{i("url: ",e),t(e)}))}),[e]),chrome.runtime.onMessage.addListener(((e,n,r)=>{i("heard message: ",e),"spreadsheetUrlChanged"===e.message&&(t(e.newUrl),a(!1))})),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("header",{children:(0,r.jsxs)("div",{className:"flex-container",children:[(0,r.jsx)(s.Pd.Provider,{value:{className:"back-icon"},children:(0,r.jsx)("a",{href:"popup.html",children:(0,r.jsx)(d.YiX,{})})}),(0,r.jsx)("div",{className:"title",children:"AO3E Rewritten's Options"})]})}),(0,r.jsx)("main",{children:(0,r.jsxs)("div",{className:"options-container",children:[(0,r.jsx)("div",{children:"Google Spreadsheets URL"}),(0,r.jsx)("input",{type:"text",defaultValue:e}),(0,r.jsx)(v,{}),(0,r.jsx)(h.Provider,{value:{loader:n,setLoader:a},children:(0,r.jsx)(f,{})})]})})]})}),{})}),document.getElementById("root"))}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.m=t,e=[],r.O=(t,n,o,a)=>{if(!n){var s=1/0;for(l=0;l<e.length;l++){for(var[n,o,a]=e[l],d=!0,i=0;i<n.length;i++)(!1&a||s>=a)&&Object.keys(r.O).every((e=>r.O[e](n[i])))?n.splice(i--,1):(d=!1,a<s&&(s=a));if(d){e.splice(l--,1);var u=o();void 0!==u&&(t=u)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[n,o,a]},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={798:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[s,d,i]=n,u=0;if(s.some((t=>0!==e[t]))){for(o in d)r.o(d,o)&&(r.m[o]=d[o]);if(i)var l=i(r)}for(t&&t(n);u<s.length;u++)a=s[u],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(l)},n=self.webpackChunkchrome_extension_typescript_starter=self.webpackChunkchrome_extension_typescript_starter||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=r.O(void 0,[736],(()=>r(938)));o=r.O(o)})();